<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>μ‹μ¤ν… μΊμ‹± μ •μ±… λ° λ°μ΄ν„° νλ¦„</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --card-bg: #2d2d2d;
            --accent-color: #3b82f6;
            --border-color: #404040;
            --code-bg: #111;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        h1,
        h2,
        h3 {
            color: #fff;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 1.5em;
        }

        h1 {
            margin-top: 0;
            font-size: 2em;
            border-bottom: 2px solid var(--accent-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--bg-color);
            border-radius: 8px;
            overflow: hidden;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: #333;
            color: var(--accent-color);
            font-weight: 600;
        }

        code {
            background-color: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            font-size: 0.9em;
        }

        pre {
            background-color: var(--code-bg);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid var(--border-color);
        }

        .mermaid {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .badge-client {
            background: #10b981;
            color: #fff;
        }

        .badge-server-mem {
            background: #f59e0b;
            color: #fff;
        }

        .badge-server-file {
            background: #6366f1;
            color: #fff;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            th,
            td {
                padding: 8px 10px;
                font-size: 0.9em;
            }

            h1 {
                font-size: 1.5em;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>μ‹μ¤ν… μΊμ‹± μ •μ±… λ° λ°μ΄ν„° νλ¦„ λ¶„μ„</h1>
        <p>μ΄ λ¬Έμ„λ” μ£Όμ‹ λ¨λ‹ν„°λ§ μ‹μ¤ν…μ μ„±λ¥ μµμ ν™”μ™€ API λΉ„μ© μ κ°μ„ μ„ν•΄ κµ¬ν„λ <strong>μ΄μ¤‘ μΊμ‹± μ•„ν‚¤ν…μ²(Dual Caching Architecture)</strong>λ¥Ό μ„¤λ…ν•©λ‹λ‹¤.
        </p>

        <h2>1. μΊμ‹± μ •μ±… κ°μ” (Caching Policy)</h2>
        <p>μ‹μ¤ν…μ€ <strong>ν΄λΌμ΄μ–ΈνΈ(λΈλΌμ°μ €)</strong>μ™€ <strong>μ„λ²„(Backend)</strong> μ–‘μ½μ—μ„ μΊμ‹±μ„ μν–‰ν•μ—¬ λ¶ν•„μ”ν• λ„¤νΈμ›ν¬ ν†µμ‹ κ³Ό κ³ λΉ„μ©μ AI API νΈμ¶μ„
            μµμ†ν™”ν•©λ‹λ‹¤.</p>

        <table>
            <thead>
                <tr>
                    <th>κµ¬λ¶„</th>
                    <th>μ„μΉ</th>
                    <th>μ €μ¥ λ§¤μ²΄</th>
                    <th>λ§λ£ μ‹κ°„ (TTL)</th>
                    <th>μ£Όμ” μ—­ν• </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="badge badge-client">ν΄λΌμ΄μ–ΈνΈ μΊμ‹ (L1)</span></td>
                    <td>λΈλΌμ°μ € λ©”λ¨λ¦¬</td>
                    <td>JS κ°μ²΄ (<code>_analysisCache</code>)</td>
                    <td><strong>10λ¶„</strong></td>
                    <td><strong>μ΄κ³ μ† μ‘λ‹µ (Hot Data)</strong>, ν™”λ©΄ μ „ν™ μ‹ μ¦‰μ‹ λ΅λ”©</td>
                </tr>
                <tr>
                    <td><span class="badge badge-client">ν΄λΌμ΄μ–ΈνΈ μ¤ν† λ¦¬μ§€ (L2)</span></td>
                    <td>λΈλΌμ°μ € μ €μ¥μ†</td>
                    <td>LocalStorage</td>
                    <td><strong>60λ¶„</strong></td>
                    <td><strong>μƒλ΅κ³ μΉ¨ μ μ§€</strong>, μ„λ²„ μ”μ²­ μµμ†ν™”</td>
                </tr>
                <tr>
                    <td><span class="badge badge-server-mem">μ„λ²„ λ©”λ¨λ¦¬ μΊμ‹ (L1)</span></td>
                    <td>Flask μ„λ²„</td>
                    <td>RAM (<code>_memory_cache</code>)</td>
                    <td><strong>10λ¶„</strong></td>
                    <td><strong>μ΄κ³ μ† μ‘λ‹µ (Hot Data)</strong>, μμ£Ό μ΅°νλλ” μΆ…λ©μ λΉ λ¥Έ λ°ν™</td>
                </tr>
                <tr>
                    <td><span class="badge badge-server-file">μ„λ²„ νμΌ μΊμ‹ (L2)</span></td>
                    <td>μ„λ²„ λ””μ¤ν¬</td>
                    <td>JSON νμΌ (<code>cache/</code>)</td>
                    <td><strong>60λ¶„</strong></td>
                    <td><strong>API λΉ„μ© μ κ° (Long-tail)</strong>, λ°μ΄ν„° μμ†μ„± λ° μ‚¬μ©μ κ°„ κ³µμ </td>
                </tr>
            </tbody>
        </table>

        <h2>2. λ°μ΄ν„° νλ¦„λ„ (Data Flow Architecture)</h2>
        <p>μ‚¬μ©μκ°€ νΉμ • μΆ…λ©(μ: μ‚Όμ„±μ „μ)μ λ¶„μ„ μ •λ³΄λ¥Ό μ”μ²­ν•  λ•μ λ°μ΄ν„° μ²λ¦¬ νλ¦„μ…λ‹λ‹¤.</p>

        <div class="mermaid">
            sequenceDiagram
            participant User as π‘¤ μ‚¬μ©μ (λΈλΌμ°μ €)
            participant ClientL1 as π“¦ ν΄λΌμ΄μ–ΈνΈ L1 (Memory)
            participant ClientL2 as οΏ½ ν΄λΌμ΄μ–ΈνΈ L2 (Storage)
            participant Server as π–¥οΈ μ„λ²„ (Flask)
            participant ServerCache as π—„οΈ μ„λ²„ μΊμ‹ (File/Mem)
            participant Gemini as π§  Google Gemini API

            Note over User, ClientL1: 1. λ°μ΄ν„° μ”μ²­
            User->>ClientL1: μΆ…λ© λ¶„μ„ μ”μ²­ (μ‚Όμ„±μ „μ)

            alt L1 μΊμ‹ μ ν¨ (Hit)
            ClientL1-->>User: β΅ μ¦‰μ‹ λ°ν™ (0ms)
            else L1 μΊμ‹ μ—†μ (Miss)
            ClientL1->>ClientL2: 2. L2 μ¤ν† λ¦¬μ§€ ν™•μΈ

            alt L2 μΊμ‹ μ ν¨ (Hit)
            ClientL2-->>User: π’Ύ μ¤ν† λ¦¬μ§€ λ°μ΄ν„° λ°ν™
            ClientL2->>ClientL1: L1μΌλ΅ μΉκ²© (Promote)
            else L2 μΊμ‹ μ—†μ (Miss)
            ClientL2->>Server: 3. API μ”μ²­ (/api/analyze)

            Server->>ServerCache: 4. μ„λ²„ μΊμ‹ ν™•μΈ

            alt μ„λ²„ μΊμ‹ μ ν¨ (Hit)
            ServerCache-->>Server: π“‚ νμΌ/λ©”λ¨λ¦¬ λ°μ΄ν„° λ°ν™
            else μ„λ²„ μΊμ‹ μ—†μ (Miss)
            Server->>Gemini: 5. AI λ¶„μ„ μ”μ²­ (π’° λΉ„μ© λ°μƒ)
            Gemini-->>Server: 6. λ¶„μ„ κ²°κ³Ό μ‘λ‹µ
            Server->>ServerCache: 7. κ²°κ³Ό μ €μ¥ (κ³µμ  μΊμ‹ μƒμ„±)
            end

            Server-->>ClientL2: 8. μ‘λ‹µ μ „μ†΅ & L2 μ €μ¥
            ClientL2-->>ClientL1: 9. L1 μ €μ¥
            ClientL1-->>User: 10. ν™”λ©΄ ν‘μ‹
            end
            end
        </div>

        <h2>3. μƒμ„Έ κµ¬ν„ λ΅μ§</h2>

        <h3>A. ν΄λΌμ΄μ–ΈνΈ μΈ΅ μΊμ‹± (<code>static/js/ui.js</code>)</h3>
        <ul>
            <li><strong>κ³„μΈµμ  κµ¬μ΅°</strong>: <strong>L1(λ©”λ¨λ¦¬)</strong> β†’ <strong>L2(LocalStorage)</strong> μμ„λ΅ ν™•μΈν•©λ‹λ‹¤.</li>
            <li><strong>λ™μ‘ μ›λ¦¬</strong>:
                <ol>
                    <li><strong>L1 λ©”λ¨λ¦¬ μΊμ‹</strong>: <code>_analysisCache</code> κ°μ²΄μ— λ°μ΄ν„°λ¥Ό μ €μ¥ν•©λ‹λ‹¤. μ•± μ‚¬μ© μ¤‘ νƒ­ μ „ν™μ΄λ‚ λ°λ³µ ν΄λ¦­ μ‹
                        <strong>0ms</strong> μ‘λ‹µμ„ λ³΄μ¥ν•©λ‹λ‹¤. (TTL 10λ¶„)</li>
                    <li><strong>L2 μ¤ν† λ¦¬μ§€ μΊμ‹</strong>: <code>localStorage</code>μ— JSON λ¬Έμμ—΄λ΅ μ €μ¥ν•©λ‹λ‹¤. <strong>λΈλΌμ°μ €
                            μƒλ΅κ³ μΉ¨</strong> ν›„μ—λ„ λ°μ΄ν„°κ°€ μ μ§€λμ–΄ μ„λ²„ λ¶€ν•λ¥Ό μ¤„μ…λ‹λ‹¤. (TTL 60λ¶„)</li>
                    <li><strong>μ¤‘λ³µ μ”μ²­ λ°©μ§€</strong>: <code>_pendingRequests</code>λ¥Ό ν†µν•΄ λ™μΌ μΆ…λ©μ— λ€ν• μ¤‘λ³µ λ„¤νΈμ›ν¬ μ”μ²­μ„ μ›μ² μ°¨λ‹¨ν•©λ‹λ‹¤.
                    </li>
                </ol>
            </li>
        </ul>

        <h3>B. μ„λ²„ μΈ΅ μΊμ‹± (<code>gemini_service.py</code>)</h3>
        <ul>
            <li><strong>κ³„μΈµμ  κµ¬μ΅°</strong>: <code>λ©”λ¨λ¦¬ μΊμ‹</code> β†’ <code>νμΌ μΊμ‹</code> μμ„λ΅ ν™•μΈν•λ” <strong>L1/L2 μΊμ‹ κµ¬μ΅°</strong>λ¥Ό
                κ°€μ§‘λ‹λ‹¤.</li>
            <li><strong>νμΌ μΊμ‹ (L2)</strong>:
                <ul>
                    <li>κ²½λ΅: <code>cache/{μΆ…λ©μ½”λ“}_{νƒ€μ…}_{λ‚ μ§}.json</code></li>
                    <li><strong>Atomic Write</strong>: λ°μ΄ν„° μ†μƒμ„ λ°©μ§€ν•κΈ° μ„ν•΄ μ„μ‹ νμΌ μ‘μ„± ν›„ μ΄λ¦„ λ³€κ²½(<code>rename</code>) λ°©μ‹μ„ μ‚¬μ©ν•©λ‹λ‹¤.
                    </li>
                    <li><strong>κ³µμ  μΊμ‹ ν¨κ³Ό</strong>: <strong>μ‚¬μ©μ A</strong>κ°€ λ¶„μ„ν• κ²°κ³Όλ¥Ό μ„λ²„ νμΌλ΅ μ €μ¥ν•΄λ‘λ©΄, <strong>μ‚¬μ©μ B</strong>κ°€
                        λ™μΌ μΆ…λ© μ΅°ν μ‹ API νΈμ¶ μ—†μ΄ μ €μ¥λ νμΌμ„ κ·Έλ€λ΅ λ°ν™λ°›μµλ‹λ‹¤.</li>
                </ul>
            </li>
        </ul>

        <h2>4. μ„λ²„-ν΄λΌμ΄μ–ΈνΈ μƒνΈμ‘μ© λ¶„μ„ (Interaction Analysis)</h2>

        <h3>A. μ„λ²„ (Server) λ™μ‘ νΉμ„±</h3>
        <ul>
            <li><strong>κµ¬κΈ€ κ²€μƒ‰μ λ³΄μ•μ„±</strong>: κµ¬κΈ€ κ²€μƒ‰ λ΅μ§(<code>gemini_service.py</code>)μ€ 100% μ„λ²„ λ‚΄λ¶€μ—μ„λ§ μ‹¤ν–‰λ©λ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈ μ½”λ“λ” κ²€μƒ‰
                API ν‚¤λ‚ λ΅μ§μ— μ ‘κ·Όν•  μ μ—†μ–΄ λ³΄μ•μƒ μ•μ „ν•©λ‹λ‹¤.</li>
            <li><strong>Lazy Loading (μ§€μ—° λ΅λ”©)</strong>: μ„λ²„λ” μ¤μ¤λ΅ λ°μ΄ν„°λ¥Ό λ―Έλ¦¬ μμ§‘ν•μ§€ μ•μµλ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈμ <strong>μ”μ²­μ΄ λ“¤μ–΄μ¤λ” μκ°„</strong>μ—λ§
                λ¶„μ„μ„ μ‹μ‘ν•κ³  κ²°κ³Όλ¥Ό μΊμ‹±ν•©λ‹λ‹¤.</li>
        </ul>

        <h3>B. λ™μ‹ μ”μ²­ μ²λ¦¬ (Concurrency)</h3>
        <ul>
            <li><strong>μ‹λ‚λ¦¬μ¤</strong>: λ‘ λ…μ μ‚¬μ©μκ°€ κ±°μ λ™μ‹μ—(λ°€λ¦¬μ΄ μ°¨μ΄) κ°™μ€ μΆ…λ©μ„ μ²μμΌλ΅ μ΅°νν•λ” κ²½μ°</li>
            <li><strong>λ™μ‘</strong>: ν„μ¬ λ³„λ„μ μ κΈ(Lock) μ¥μΉκ°€ μ—†μΌλ―€λ΅, λ‘ μ”μ²­ λ¨λ‘ APIλ¥Ό νΈμ¶ν•μ—¬ μ¤‘λ³µ μ‘μ—…μ΄ λ°μƒν•  μ μμµλ‹λ‹¤.</li>
            <li><strong>κ²°κ³Ό</strong>: λ‘ μ‘μ—… μ¤‘ λ‚μ¤‘μ— λλ‚λ” μ½μ λ°μ΄ν„°κ°€ μµμΆ…μ μΌλ΅ μΊμ‹ νμΌμ— μ €μ¥λλ©°, μ΄ν›„μ μ”μ²­λ¶€ν„°λ” ν•΄λ‹Ή μΊμ‹λ¥Ό κ³µμ ν•κ² λ©λ‹λ‹¤.</li>
        </ul>

        <h2>5. μ‹μ¤ν… μ΄μ  (Benefits)</h2>
        <ul>
            <li><strong>λΉ„μ© μ κ° (Cost Efficiency)</strong>: μΊμ‹±μ„ ν†µν•΄ λ™μΌ μΆ…λ©μ— λ€ν• μ¤‘λ³µ νΈμ¶μ„ 90% μ΄μƒ μ κ±°ν•  μ μμµλ‹λ‹¤.</li>
            <li><strong>μ†λ„ ν–¥μƒ (Performance)</strong>: AI λ¶„μ„μ€ ν†µμƒ 3~5μ΄κ°€ μ†μ”λμ§€λ§, μΊμ‹λ λ°μ΄ν„°λ” <strong>0.01μ΄ μ΄λ‚΄</strong>μ— λ°ν™λ©λ‹λ‹¤.
            </li>
            <li><strong>λ°μ΄ν„° μΌκ΄€μ„± (Consistency)</strong>: μ§§μ€ μ‹κ°„ λ‚΄μ— μ—¬λ¬ μ‚¬μ©μκ°€ μ΅°νν•λ”λΌλ„ λ™μΌν• λ¶„μ„ κ²°κ³Όλ¥Ό μ κ³µν•μ—¬ μ •λ³΄μ νΌμ„ μ„ λ°©μ§€ν•©λ‹λ‹¤.</li>
        </ul>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#e0e0e0',
                edgeLabelBackground: '#fff',
                tertiaryColor: '#fff'
            }
        });
    </script>
</body>

</html>